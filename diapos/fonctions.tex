\section{Fonctions définies par l'usager}

\subsection{Définition d'une fonction}

\begin{frame}
  \frametitle{Définition d'une fonction}

  On définit une fonction de la manière suivante:
  \begin{center}
    \code{fun <- function(\emph{arguments}) \emph{expression}}
  \end{center}
  où
  \begin{itemize}
  \item \code{fun}: nom de la fonction
  \item \code{\itshape arguments}: liste des arguments, séparés par
    des virgules
  \item \code{\itshape expression}: corps de la fonction,
    suite d'expressions groupées entre accolades
  \end{itemize}
\end{frame}

\subsection{Retourner des résultats}

\begin{frame}
  \frametitle{Retourner des résultats}

  \begin{itemize}
  \item Une fonction retourne le résultat de la \alert{dernière
      expression} du corps
  \item Éviter que la dernière expression soit une affectation: la
    fonction ne retournera rien!
  \item Parfois nécessaire d'utiliser explicitement
    \Fonction{\alert{return}}
  \item Utiliser une liste nommée pour retourner plusieurs résultats
  \end{itemize}
\end{frame}

\subsection{Variables locales et globales}

\begin{frame}[fragile]
  \frametitle{Variables locales et globales}

  \begin{itemize}
  \item<+-> Toute variable définie dans une fonction est locale à cette
    fonction, c'est-à-dire
    \begin{itemize}
    \item<+-> n'apparaît pas dans l'espace de travail
    \item<+-> n'écrase pas une variable du même nom dans l'espace
      de travail
    \end{itemize}
  \item<+| only@-+> Possible de définir une variable dans l'espace de
    travail depuis une fonction avec l'opérateur $<<-$
  \item<only@+-> \sout{Possible de définir une variable dans l'espace de
      travail depuis une fonction avec l'opérateur $<<-$}
  \item<+-> Fonction définie à l'intérieur d'une autre fonction locale
    à celle-ci
  \end{itemize}
\end{frame}


\subsection{Exemple de fonction}

\begin{frame}[fragile]
  \frametitle{Fonction à partir du code de point fixe}

\begin{semiverbatim}
{\color<2>{orange}fp} <- function({\color<3>{orange}k}, {\color<3>{orange}n}, {\color<3>{orange}start = {\color<4>{orange}0.05}}, {\color<3>{orange}TOL = {\color<4>{orange}1E-10}})
\{
    {\color<5>{orange}i <- start
    repeat
    \{
        it <- i
        i <- (1 - (1 + it)^(-n))/k
        if (abs(i - it)/it < TOL)
            break
    \}
    {\color<6>{orange}i}}
\}
\end{semiverbatim}
\end{frame}


\subsection{Fonctions anonymes}

\begin{frame}
  \frametitle{Fonctions anonymes}

  \begin{itemize}
  \item Parfois utile de définir une fonction sans lui attribuer un
    nom
  \item C'est une \alert{fonction anonyme}
  \item En général pour des fonctions courtes utilisées dans une autre
    fonction
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Un exemple}

  \begin{itemize}[<+->]
  \item Calculer la valeur de $x y^2$ pour toutes les combinaisons de
    $x$ et $y$
  \item Avec \fonction{outer}:
  \begin{Schunk}
\begin{Sinput}
> x <- 1:3
> y <- 4:6
> f <- function(x, y) x * y^2
> outer(x, y, f)
\end{Sinput}
\begin{Soutput}
     [,1] [,2] [,3]
[1,]   16   25   36
[2,]   32   50   72
[3,]   48   75  108
\end{Soutput}
\end{Schunk}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \begin{itemize}
  \item Avec une fonction anonyme:
\begin{Schunk}
\begin{Sinput}
> outer(x, y, function(x, y) x * y^2)
\end{Sinput}
\begin{Soutput}
     [,1] [,2] [,3]
[1,]   16   25   36
[2,]   32   50   72
[3,]   48   75  108
\end{Soutput}
\end{Schunk}
  \end{itemize}
\end{frame}


\subsection{Débogage de fonctions}

\begin{frame}
  \frametitle{Techniques les plus simples et naïves}

  \begin{itemize}[<+->]
  \item Simples erreurs de syntaxe sont les plus fréquentes (en
    particulier l'oubli de virgules)
  \item Vérification de la syntaxe lors de la définition d'une
    fonction
  \item Première approche:
    \begin{enumerate}[<3->]
    \item placer des commandes \fonction{\alert{print}} à l'intérieur
      de la fonction
    \item exécuter la fonction normalement
    \end{enumerate}
  \item Deuxième approche:
    \begin{enumerate}[<4->]
    \item définir toutes les variables passées en arguments dans
      l'espace de travail
    \item exécuter les lignes de la fonction une à une
    \end{enumerate}
  \end{itemize}
\end{frame}

\begin{frame}[fragile=singleslide]
  \begin{exampleblock}{Exemple}
    Modification de la boucle du point fixe pour détecter une
    procédure divergente.
\begin{verbatim}
repeat
{
    it <- i
    i <- (1 - (1 + it)^(-n))/k
    print(i)
    if (abs((i - it)/it < TOL))
        break
}
\end{verbatim}
  \end{exampleblock}
\end{frame}

% \begin{frame}
%   \frametitle{Avec Emacs et le mode ESS}

%   \begin{itemize}[<+->]
%   \item S'assurer que toutes les variables passées en arguments à une
%     fonction existent dans l'espace de travail.
%   \item Exécuter successivement les lignes de la fonction avec
%     \ess{C-c C-n}.
%   \item Impossible avec les interfaces graphiques car la fenêtre
%     d'édition de fonctions bloque l'accès à l'interface de commande.
%   \end{itemize}
% \end{frame}


% \subsection{Styles de codage}

% \begin{frame}[fragile=singleslide]
%   \frametitle{Styles reconnus par Emacs}

%   \small
%   \begin{center}
%     \begin{minipage}[t]{9cm}
%       C++/Stroustrup
%       \hfill
%       \begin{minipage}[t]{5cm}
% \begin{verbatim}
% for (i in 1:10)
% {
%     expression
% }
% \end{verbatim}
%       \end{minipage}
%     \end{minipage}
%     \vspace{\baselineskip}

%     \begin{minipage}[t]{9cm}
%       K\&R (1TBS)
%       \hfill
%       \begin{minipage}[t]{5cm}
% \begin{verbatim}
% for (i in 1:10){
%      expression
% }
% \end{verbatim}
%       \end{minipage}
%     \end{minipage}
%     \vspace{\baselineskip}

%     \begin{minipage}[t]{9cm}
%       Whitesmith
%       \hfill
%       \begin{minipage}[t]{5cm}
% \begin{verbatim}
% for (i in 1:10)
%      {
%      expression
%      }
% \end{verbatim}
%       \end{minipage}
%     \end{minipage}
%     \vspace{\baselineskip}

%     \begin{minipage}[t]{9cm}
%       GNU
%       \hfill
%       \begin{minipage}[t]{5cm}
% \begin{verbatim}
% for (i in 1:10)
%   {
%     expression
%   }
% \end{verbatim}
%       \end{minipage}
%     \end{minipage}
%   \end{center}
% \end{frame}

% \begin{frame}[fragile]
%   \frametitle{Standard pour la programmation en S}

%   \begin{itemize}
%   \item Style C$++$, avec les accolades sur leurs propres lignes.
%   \item Une indentation de quatre (4) espaces.
%   \item<2-> Pour utiliser ce style dans Emacs\index{Emacs}, faire
% \begin{verbatim}
%     M-x ess-set-style RET C++ RET
% \end{verbatim}
%     une fois qu'un fichier de script est ouvert.
%   \end{itemize}
% \end{frame}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "introduction_programmation_S_diapos"
%%% End:
